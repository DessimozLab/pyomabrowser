{% extends "seqCV.html" %}
{% load staticfiles %}

{% block title %}OMA: Hierarchical Orthologous Groups for {{ fam.id }}{% endblock %}
{% block meta_description %}Hierarchical orthologous groups (HOGs) provide a set of genes that have all started diverging from a single ancestral gene at the taxonomic range of interest.{% endblock %}
{% block js_hook %}
<!-- D3 -->
<!--<script src="{% static "js/d3.v3.min.js" %}" charset="utf-8"></script>-->
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="http://benschmidt.org/colorbar/colorbar.js" charset="utf-8"></script>

<!-- Underscore -->
<script src="{% static "js/underscore-min.js" %}"></script>

  <!-- TnT -->
  <link rel="stylesheet" href="{% static "css/tnt.css" %}" type="text/css" />
  <link rel="stylesheet" href="{% static "css/hog.css" %}" type="text/css" />
  <link rel="stylesheet" href="http://tntvis.github.io/tnt.tooltip/build/tnt.tooltip.css" type="text/css" />
  <script src="http://tntvis.github.io/tnt/build/tnt.min.js" charset="utf-8"></script>
<script src="http://tntvis.github.io/tnt.tooltip/build/tnt.tooltip.min.js" charset="UTF-8"></script>
<script src="{% static "js/hog.js" %}" charset="UTF-8"></script>
    <script src="{% static "js/orthoxml-hogvis.min.js" %}" charset="UTF-8"></script>

{% endblock %}

{% block contentTab %}

<div  style="background-color: white; padding:10px;">

<div id="gap_conpenser"> </div>

<div id="hogvisheader">

    {% if isSingleton %}This entry is not part of any hierarchical orthologous group.
    {% else %}
    <h3>Hierarchical group {{ fam.id }} open at level of <span id="current_level_text" style="font-weight:bold;"></span> </h3>

    <div id="genedata-vis"> </div>
    <div id="colorbar"> </div>

  </div>

  <div id="hog_vis"> </div>


  <script>

  // Init the hogvis
    (function () {
        var query = {'id': {{ entry.entry_nr }} };
        var tooltip_data = {{ xrefs|safe }};

        $.when(
            $.ajax({url: "/oma/hogs/{{ entry.entry_nr }}/orthoxml",
                    dataType: "text"}),
            $.ajax({url: "/All/speciestree.nwk"})
        ).then(function(orthoxml, speciestree){
            var hog_data = hogvis.parse_orthoxml(speciestree[0], orthoxml[0]);
            var options = {'show_internal_labels': {{ show_internal_labels|yesno:"true,false" }},
                       'oma_info_url_template': "/cgi-bin/gateway.pl?f=DisplayEntry&amp;p1=",
                       'current_level_div': "current_level_text"};

            var theme = hog_theme();
            theme(document.getElementById ("hog_vis"), query, hog_data.per_species,
                  hog_data.tree, tooltip_data, options, document.getElementById("genedata-vis"));
        });
    }) ();

</script>


{% endif %}

</div>

{% endblock %}
{% load staticfiles %}

        <table class="table table-hover" id="grpTable"
               data-show-toggle="false"
               data-show-columns="false" data-search="true" data-show-export="true"
               data-mobile-responsive="true" data-check-on-init="true"
               data-undefined-text=""
               data-id-field="id" data-row-attributes="tablehooks.add_proteinrow_attrs" >
            <thead>


             <tr>
                <th  data-field="id" data-sortable="true" data-formatter="tablehooks.format_hogid">HOG ID</th>
                <th  data-field="jaccard" data-sortable="true">Jaccard similarity <i class="fas fa-info-circle" rel="tooltip" title="Jaccard similarity between reference hog profile and  target hog profile" ></i></th>
                <th data-class='profile_cell' data-width="300"  > <div id="profile_ref"></div></th>
                <th  data-field="description" data-sortable="true">Description</th>


    </tr>



            </thead>


        </table>


<!-- D3 and D3 Tooltip -->
<script src="{% static "js/d3.v3.min.js" %}" type="text/javascript"></script>
<script src="{% static "js/d3.tip.v0.6.3.js" %}" type="text/javascript"></script>

        <!-- Exon Visualisation -->
<script src="{% static "js/exon_vis.js" %}" type="text/javascript"></script>
<link href="{% static "css/exon_vis.css" %}" rel="stylesheet" type="text/css" />

<!-- bootstrap-table -->
<script src="{% static "js/tablehooks.js" %}" type="text/javascript"></script>
<script src="{% static "js/bootstrap-table.min.js" %}"></script>

<link href="{% static "css/bootstrap-table.min.css" %}" rel="stylesheet" type="text/css"/>
<script src="{% static "js/bootstrap-table-export.min.js" %}"></script>
<script src="{% static "js/bootstrap-table-mobile.min.js" %}"></script>
<script src="{% static "js/tableExport.min.js" %}"></script>

<!-- D3 todo dl the lib-->
<script src="https://d3js.org/d3.v5.js"></script>

<!-- Profile Visualisation -->
<script src='{% static "js/profile.js" %}' type="text/javascript"></script>
<link href='{% static "css/profile.css" %}' rel="stylesheet" type="text/css"/>






<script>

    $(document).ready(function(){
    $("[rel=tooltip]").tooltip({ placement: 'right'});
});

    $.getJSON("{{ table_data_url }}", function (alldata) {
    //$.getJSON("https://oma-stage.vital-it.ch/oma/hog/similar/profile/json/HOG:0455705/", function (alldata) {

        var data = alldata["profile"]
        var ref;

        for (var i = data.length - 1; i >= 0; --i) {
            if (data[i].id == "Reference") {
                ref = data[i]
        data.splice(i,1);
    }
}

        console.log(data)
        console.log(ref)

        var tab = $("#grpTable");
        var icons = tab.bootstrapTable('getOptions').icons;
        $.extend(icons, {export: 'fa-download'});
        tab.bootstrapTable({
            data: data ,
            reorderableColumns: true,
            clickToSelect: false,
            showMultiSort: true,
            showLoading: true,
            height:$(window).height() - 300,
            onPostBody: function (data) {

                profile.visualize_header("profile_ref", ref["profile"], data["tax"], data["species"] )

                $.each($(".profile_cell"), function (each, value) {

                    if (this.tagName !=  "TH") {

                        console.log(this.tagName)


                        profile.visualize(this, ref["profile"], data["tax"], data["species"])

                    }
                })





            },
            onLoadSuccess: function () {

                tab.bootstrapTable('hideLoading');
            },
            refreshOptions: {'icons': icons}
        });

    });

</script>


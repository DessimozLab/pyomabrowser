{% extends  "core.html" %}
{% load staticfiles %}
{% load bootstrap3 %}

{% block title %}Matrix specifications{% endblock %}

{% block content %}

<style>

    .master-tile{
        background-color: #f8f9fa;
        padding: 30px
    }

    .section-title{
        color:#bbb;
        font-weight: bold;
        font-size: 1.2em !important;

    }

    .section-tile{
        margin-bottom:24px;
    }

    .section-box{
        background-color: #fff;
        padding: 16px;
        box-shadow: 2px 2px 1px #eee;
        border-radius: 4px;
        margin:8px;
    }

    .icon_selector{
        margin-right:8px;
        color:#555;
    }

    .text_selector{
        margin-right:8px;
        color:#555;
    }


    .number-span{margin-left:1em;}


</style>



<div class="container-fluid" >

    <div class="row">

        <div class="col-sm-12 col-md-10 col-md-offset-1 master-tile">

            <div class="section-tile">


                <p class="section-title">OMA RELEASE OF {{ rel_name }}</p>


                <div class="section-box">


                    <ul class="list-unstyled">
                        <li><b>Number of species: </b> <span class="number-span"> {{ nb_genome }}</span></li>
                        <li><b>Number of OMA groups: </b> <span class="number-span">????????</span></li>
                        <li><b>Number of proteins: </b> <span class="number-span">{{ nb_prot }}</span></li>
                        <li><b>Proteins with external links: </b> <span class="number-span"> ???? (??.? %)</span></li>
                        <li><b>Gene Ontology: </b> <span class="number-span">???????? entries in ??????? OMA groups</span></li>
                    </ul>


                </div>

            </div>

            <div class="section-tile">


                <p class="section-title">SPECIES INFORMATION


                    <button type="button" id="btree" class="btn btn-default pull-right icon_selector">
                        <span class="glyphicon glyphicon-tree-deciduous pull-right " aria-hidden="true"
                              data-toggle="tooltip" data-placement="top" title="view as species tree" ></span>
                    </button>

                    <button type="button" id="blist"  class="btn btn-default pull-right icon_selector" >
                        <span class="glyphicon glyphicon-list pull-right " aria-hidden="true"
                              data-toggle="tooltip" data-placement="top" title="view as species list" ></span>
                    </button>

                    <button type="button" id="bhist"  class="btn btn-default pull-right icon_selector" >
                        <span class="glyphicon  glyphicon-stats pull-right " aria-hidden="true"
                              data-toggle="tooltip" data-placement="top" title="view as species histogram"></span>
                    </button>

                    <span class="pull-right text_selector">Change the view: </span>

                </p>


                <div class="section-box">


                        <div class="panel-body" id="genome_panel" >

                        </div>

                </div>

            </div>


        </div>

    </div>

</div>

<!-- D3 and D3 Tooltip -->
<script src="{% static "js/d3.v3.min.js" %}" type="text/javascript"></script>
<script src="{% static "js/d3.tip.v0.6.3.js" %}" type="text/javascript"></script>

<!-- Domain Visualisation -->
<script src="{% static "js/domains_vis.js" %}" type="text/javascript"></script>
<link href="{% static "css/domains_vis.css" %}" rel="stylesheet" type="text/css"/>

    <!-- bootstrap-table -->
    <script src="{% static "js/tablehooks.js" %}" type="text/javascript"></script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/extensions/filter-control/bootstrap-table-filter-control.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/extensions/export/bootstrap-table-export.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/extensions/mobile/bootstrap-table-mobile.min.js"></script>
<script src="{% static "js/tableExport.min.js" %}"></script>


<script>

    // turn on tooltips
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })

    // get the button and set update genome function
    var btree = document.getElementById("btree");
    btree.addEventListener("click", function(){
        btree.addEventListener("click", update_genome_viewer(this.id));
    });

    var blist = document.getElementById("blist");
    blist.addEventListener("click", function(){
        blist.addEventListener("click", update_genome_viewer(this.id));
        });

    var bhist = document.getElementById("bhist");
    bhist.addEventListener("click", function(){
        bhist.addEventListener("click", update_genome_viewer(this.id));
        });

    function update_genome_viewer(bid){

        // clean current viewer
        var cviewer = document.getElementById("genome_panel");
        cviewer.innerHTML='';
        while (cviewer.firstChild) {
            cviewer.removeChild(cviewer.firstChild);
        }

        // build tree view
        if (bid === "btree") {

            // display under construction
            var under = document.createElement('h3');
            under.innerHTML = "This part is under construction!";
            under.className = "text-center";
            cviewer.appendChild(under);

        }

        // build table view
        else if (bid === "blist") {

            // create empty table
            var tbl = document.createElement('table');
            tbl.id = "genomeTable";
            cviewer.appendChild(tbl);

            // feed it !
            init_table('genomeTable');}

        // build hist view
        else if (bid === "bhist") {
            // display under construction
            var under = document.createElement('h3');
            under.innerHTML = "This part is under construction!";
            under.className = "text-center";
            cviewer.appendChild(under);
        }

    }

    function init_table(div_id){

    var tab = $('#' + div_id);
    tab.bootstrapTable({
        url: "{% url 'genomes_json' %}",
        reorderableColumns:true,
        pagination: true,
        pageSize:10,
        showColumns: true,
        search: true,
        showExport: true,
        pageList: [10, 25, 50, 100, "All"],
        mobileResponsive: true,
        checkOnInit: true,
        undefinedText: "",
        idField: 'code',
        showToggle: 'true',

        columns: [{
            field: 'uniprot_species_code',
            title: 'Code'
        }, {
            field: 'sciname',
            title: 'Scientific Name'
        }, {
            field: 'prots',
            title: '# of Sequences'
        },
        {
            field: 'ncbi',
            title: 'NCBI TaxonId'
        },
        {
            field: 'kingdom',
            title: 'Kingdom'
        }]
    });

    var icons = tab.bootstrapTable('getOptions').icons;
    $.extend(icons, {export: 'glyphicon-download-alt', columns: 'glyphicon-list'});
    tab.bootstrapTable('refreshOptions', {'icons': icons});
    }

</script>


{% endblock content %}

{% extends  "core.html" %}
{% load staticfiles %}
{% load bootstrap3 %}

{% block title %}Synteny dot plot viewer{% endblock %}

{% block content %}


    <div class="container-fluid " >

        <div class="row">

            <div class="col-sm-12 col-md-10 col-md-offset-1" style="background-color: #f8f9fa">

                <div id="dotplot_container" class="tile"  >


                    <div class="text-center">

                        <h4> Synteny viewer of the {{ genome1 }} chromosome {{ chromosome1 }}
                            <em> versus </em>{{ genome2 }} chromosome {{ chromosome2 }}</h4>

                    </div>

                    <div>

                        <div>

                            <div class="btn-group pull-right" style="margin: 6px;">
                                <button class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span class="glyphicon glyphicon-hand-up" aria-hidden="true"></span>
                                    <span class="caret"></span>
                                </button>

                                <ul id="action_dropdown" class="dropdown-menu" >
                                    <li class="action_dropdown-li" id="ba-pan"><a> Pan <span id='brush_ok_pan' class="glyphicon glyphicon-ok pull-right hidden" aria-hidden="true"></span></a> </li>
                                    <!-- <li class="action_dropdown-li" id="ba-zoom"><a> Zoom in <span id='brush_ok_zoom' class="glyphicon glyphicon-ok pull-right hidden" aria-hidden="true"></span></a> </li> -->
                                    <li class="action_dropdown-li" id="ba-select"><a> Select <span id='brush_ok_select' class="glyphicon glyphicon-ok pull-right hidden" aria-hidden="true"></span></a> </li>
                                </ul>
                            </div>

                            <div class="btn-group pull-right" style="margin: 6px;">
                                <button type="button" class="btn btn-default btn-sm" aria-label="Left Align"  data-toggle="collapse" data-target="#hist_metric">
                                    <span class="glyphicon glyphicon-filter" aria-hidden="true"></span>
                                </button>
                            </div>

                        </div>

                    </div>

                    <hr>

                    <div  id="plot_div"  style="width: 100%">

                    </div>

                    <br>

                    <div class="collapse" id="hist_metric" style="width: 100%">


                    </div>

                </div>

                <div id="container_table_selection" class="tile">

                    <table id="table_selection"></table>

                </div>

            </div>

        </div>

    </div>

    </div>

    <!-- D3 and D3 Tooltip -->
    <script src="//d3js.org/d3.v4.min.js" type="text/javascript"></script>

    <!-- bootstrap-table -->
    <script src="{% static "js/tablehooks.js" %}" type="text/javascript"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/extensions/filter-control/bootstrap-table-filter-control.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/extensions/export/bootstrap-table-export.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/extensions/mobile/bootstrap-table-mobile.min.js"></script>
    <script src="{% static "js/tableExport.min.js" %}"></script>

    <!-- dot plot import -->
    <link href="{% static "css/synteny_dotplot.css" %}" rel="stylesheet" type="text/css"/>
    <script src="{% static "js/synteny_dotplot.js" %}" type="text/javascript"></script>


    <script>

        (function () {


            var container = "dotplot_container";

            var genome1 = "{{ genome1 }}";
            var genome2 = "{{ genome2 }}";

            var chromosome1 = "{{ chromosome1 }}";
            var chromosome2 = "{{ chromosome2 }}";

            var DotPlot = dotplot_theme();

            var correct_url = encodeURI("/api/pairs/" + genome1 +"/" + genome2 +"/?chr1=" + chromosome1 + "&chr2=" + chromosome2);

            console.log(correct_url);

            var dotplot = new DotPlot(container, correct_url, genome1,genome2,chromosome1,chromosome2);


            $('#table_selection').bootstrapTable({
                reorderableColumns: true,
                pagination: true,
                pageSize: 10,
                showColumns: true,
                search: true,
                showExport: true,
                pageList: [10, 25, 50, 100, "All"],
                mobileResponsive: true,
                checkOnInit: true,
                undefinedText: "",
                showToggle: 'true',
                onClickRow: function(row) {
                    dotplot.update_picked_datapoint(row);
                },
                columns: [{
                    field: 'entry_1.omaid',
                    title: genome1 + ' gene',
                    formatter: tablehooks.format_info_link,
                    sortable: true
                }, {
                    field: 'entry_1.canonicalid',
                    title: 'Cross Ref ' + genome1,
                    formatter: tablehooks.format_xref,
                    sortable: true
                }, {
                    field: 'entry_1.locus.0',
                    title: genome1 + ' position',
                    sortable: true
                }, {
                    field: 'entry_2.omaid',
                    title: genome2 + ' gene',
                    formatter: tablehooks.format_info_link,
                    sortable: true
                }, {
                    field: 'entry_2.canonicalid',
                    title: 'Cross Ref ' + genome2,
                    formatter: tablehooks.format_xref,
                    sortable: true
                }, {
                    field: 'entry_2.locus.0',
                    title: genome2 + ' position',
                    sortable: true
                }, {
                    field: 'rel_type',
                    title: 'Relation',
                    sortable: true
                }, {
                    field: 'distance',
                    title: 'Distance [PAM]',
                    formatter: tablehooks.format_float_value,
                    sortable: true
                }, {
                    field: 'score',
                    title: 'Alignment Score',
                    formatter: tablehooks.format_float_value,
                    sortable: true
                }]
            });

            $('#container_table_selection').hide()

        }) ();

    </script>



{% endblock content %}







